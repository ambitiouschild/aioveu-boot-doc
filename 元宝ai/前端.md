

## 1.API接口

### 1.1Map映射

```
    getDepartmentMapByIds(deptIds: number[]) {
      return request<Map<number, string>>({
        url: `${AIOVEUDEPARTMENT_BASE_URL}/map`,
        method: "post",
        data: deptIds
      });
    },
```

### 1.2获取所有选项

```
    /**
     * 获取所有选项列表（用于下拉选择框）
     * @returns 选项列表
     * 因为request函数的类型定义允许第一个类型参数为any，从而绕过了类型检查
     */
    getAllDepartmentOptions() {
      return request<any,DeptOptionVO[]>({
        url: `${AIOVEUDEPARTMENT_BASE_URL}/options`,
        method: "get",
      });
    }
```

### 1.3选项VO（用于下拉选择框）

```
    /** 选项VO（用于下拉选择框） */
export interface DeptOptionVO {
  /** ID */
  deptId: number;
  /** 名称 */
  deptName: string;
}
```



## 2.方法

### 2.1导入API

```
   // 新增：导入API
   //如果你看到 'Aioveu API' is defined but never used警告，说明你在导入后没有使用它。确保在代码中实际调用了 API 方法。
  import AioveuDepartmentAPI, { DeptOptionVO } from "@/api/aioveuDepartment/aioveu-department";
  
  // 导入字典值API
  import DictAPI,{ DictItemOption } from '@/api/system/dict.api'
```

### 2.2新增值

```
  // 新增：选项
  const aioveuMemberOption = ref<AioveuMemberOptionVO[]>([]);
  
    // 字典选项
  const periodQuarterOptions = ref<DictItemOption[]>([])
```

### 2.3加载选项

```
    // 加载选项
  function loadOptions() {
  
   // 加载选项
    AioveuCategoryAPI.getAllCategoryOptions().then(response => {
      parentCategoryOptions.value = response
    })
    
    // 加载字典
    DictAPI.getDictItems('performance_period_quarter').then(response => {
      periodQuarterOptions.value = response
    })
  }
  
      onMounted(() => {
    handleQuery();
    //在 onMounted钩子中调用了 loadAioveuMemberOptionVO()函数,确保函数被正确使用
    loadAioveuMemberOptionVO();
  });
  
   // 主要修改点：选项加载方法
  function loadAioveuMemberOptionVO() {
    loading.value = true;
    AioveuMemberAPI.getAllMemberNoOptions()

      .then(response => {
        // 确保响应数据是数组类型
        if (Array.isArray(response)) {
          // 转换数据类型：确保deptId是数字
          aioveuMemberOption.value = response.map(memberOption => ({
            id: Number(memberOption.id),
            memberNo: memberOption.memberNo
          }));
        } else {
          // 处理非数组响应
          console.error("选项响应格式错误:", response);
          ElMessage.error("选项格式错误");
        }
      })
      .catch(error => {
        console.error("加载选项失败:", error);
        ElMessage.error("加载选项失败");
      })
      .finally(() => {
        loading.value = false;
      });
  }
```

### 2.4弹窗设计

```
   //const editingId = ref<number | undefined>(undefined);


// 弹窗
const dialog = reactive({
  title: "",
  type: " ",// 'recharge', 'add', 'edit'
  visible: false,
});

  // 打开充值会员弹窗
  function handleOpenRechargeDialog() {
    console.log('打开充值会员弹窗');
    dialog.title = "会员充值";
    dialog.type = 'recharge'; // 标记为充值操作
    dialog.visible = true;
  }
 
   /** 打开会员充值记录弹窗 */
  function handleOpenDialog(id?: number) {
    console.log('打开弹窗', id ? '编辑' : '新增');
    //editingId.value = id; // 保存ID
    if (id) {
      dialog.title = "修改会员充值记录";
      dialog.type = 'edit'; // 标记为编辑操作
            AioveuMemberRechargeRecordAPI.getFormData(id).then((data) => {
        Object.assign(formData, data);
        	//先准备数据，再显示弹窗
              dialog.visible = true;
      });
    } else {
      dialog.title = "新增会员充值记录";
      dialog.type = 'add'; // 标记为新增操作
      //直接打开弹窗
      dialog.visible = true;
      // 重置清空表单
      dataFormRef.value.resetFields();
    }
  }
  
  
    /** 关闭员工工资明细弹窗 */
  function handleCloseDialog() {
    dialog.visible = false;
    // 关键修复：在关闭弹窗时重置加载状态
    loading.value = false;

    // 延迟重置表单（等待动画完成）
    setTimeout(() => {
    dataFormRef.value.resetFields();
    dataFormRef.value.clearValidate();
    //editingId.value = undefined;
    formData.id = undefined;
    }, 3);

  }
```







## 3.查询

前端通过下拉框选择，此时前端已经通过选项接口获取了所有选项（OptionVO列表），用户选择后，表单中提交的是value（ID）。

### 3.1映射字典

```
        <el-form-item label="考勤状态" prop="status">
              <el-select
                v-model="queryParams.status"
                placeholder="请选择考勤状态"
                clearable
                filterable
                @keyup.enter="handleQuery()"
              >
                <el-option 
                  v-for="item in statusOptions" 
                  :key="Number(item.value)"
                  :label="item.label"
                  :value="Number(item.value)"
                />
              </el-select>
         </el-form-item>
```

### 3.2映射选项



              <el-form-item label="会员卡号" prop="memberId">
                  <el-select
                    v-model="queryParams.memberId"
                    placeholder="请选择会员卡号"
                    clearable
                    filterable
                    @keyup.enter="handleQuery()"
                  >
                    <el-option
                      v-for="item in aioveuMemberOption"
                      :key="item.memberId"
                      :label="item.memberNo"
                      :value="item.memberId"
                    />
                  </el-select>
                </el-form-item>

## 4.列表



我们首先需要明确：在表格中，`scope.row`代表当前行的数据对象。`scope.row.id`就是当前行数据对象的 `id`属性值。这个 `id`应该对应数据库中的主键ID。

/scope.row.id`的来源

1. **`scope.row`是什么？**
   - 在 Element Plus 的表格组件中，`scope.row`表示**当前行的数据对象**
   - 这个对象来自于您绑定的 `pageData`数组中的元素
2. **`id`属性的来源：**
   - 这个 `id`属性来自您的 API 返回的数据结构
   - 具体来说，来自 `AioveuMemberAPI.getPage()`返回的 `data.list`中的对象
3. **数据库关系：**
   - 这个 `id`应该对应数据库表中的主键 ID
   - 在您的 `aioveu_member`表中，`id`是主键列

### 4.1映射字典

```
<!--  <template #default="scope">：使用Vue的插槽(slot)来自定义列的内容 -->
<!-- #default：这是Element UI表格列的默认插槽，用于自定义单元格显示内容-->
<!-- scope：是一个对象，包含当前行的数据（scope.row）和其他表格信息-->
<!--  DictLabel： likely是一个自定义组件，用于根据字典代码和值显示对应的标签文本 -->
<!-- v-model="scope.row.status"：双向绑定当前行数据中的status字段值（可能是数字或代码值）-->
```



```
        <el-table-column
          label="考核季度"
          min-width="150"
          align="center"
        >
          <template #default="scope">
            <DictLabel v-model="scope.row.periodQuarter" code="performance_period_quarter" />
          </template>
        </el-table-column>
```

### 4.2映射表

```
        name映射方法后端实现
        
        <!-- 修改：将所属ID改为所属名称 -->
        <el-table-column
        key="deptName"
        label="所属部门"
        prop="deptName"
        min-width="150"
        align="center"
        />
```

### 4.3显示照片

**1.使用作用域插槽**：

- `<template #default="scope">`允许访问当前行的数据
- `scope.row.imageUrl`获取当前行的图片 URL

2.**使用 `<el-image>`组件**：

- 这是 Element UI 专门用于显示图片的组件
- 支持预览功能（点击图片可放大查看）
- 提供加载状态和错误处理

```
要在 Element UI 表格中显示照片而不是显示图片路径，您需要使用作用域插槽（scoped slot）来自定义列的内容。
    <!-- 修改后的图片列 -->
    <el-table-column
        key="imageUrl"
        label="图片"
        min-width="250"
        align="center"
    >
        <template #default="scope">
            <el-image
                style="width: 80px; height: 80px;"
                :src="scope.row.imageUrl"
                :preview-src-list="[scope.row.imageUrl]"
                fit="cover"
                lazy
                :scroll-container="'.el-table__body-wrapper'"
                :preview-teleported="true"
                hide-on-click-modal
            >
                <template #placeholder>
                    <div class="image-loading">
                        <el-icon><Loading /></el-icon>
                    </div>
                </template>
                <template #error>
                    <div class="image-error">
                        <el-icon><Picture /></el-icon>
                        <span>加载失败</span>
                    </div>
                </template>
            </el-image>
        </template>
    </el-table-column>
```

**3.常用属性**：

- `:src`：绑定图片 URL
- `:preview-src-list`：设置预览图片列表（单张图片用数组包裹）
- `fit`：图片填充模式（cover：保持比例填充容器）
- `style`：设置图片显示尺寸
- `lazy`：启用懒加载
- `scroll-container="'.el-table__body-wrapper'"`：设置懒加载的滚动容

```
1.多图预览​：
<el-image
  :preview-src-list="tableData.map(item => item.imageUrl)"
>

2​缩略图+原图​： 如果图片较大，建议使用缩略图在表格中显示，点击后查看原图
<el-image
  :src="scope.row.thumbnailUrl"  // 缩略图
  :preview-src-list="[scope.row.originalUrl]"  // 原图
>
3.​自定义错误显示​：
<template #error>
  <div class="image-error">
    <el-icon><Picture /></el-icon>
    <span>图片加载失败</span>
  </div>
</template>
4.​懒加载​：
<el-image
  lazy
  :scroll-container="'.el-table__body-wrapper'"
>
5.添加加载状态和错误处理​：
<template #placeholder>
    <div class="image-loading">
        <el-icon><Loading /></el-icon>
    </div>
</template>
<template #error>
    <div class="image-error">
        <el-icon><Picture /></el-icon>
        <span>加载失败</span>
    </div>
</template>
6.可以根据屏幕大小调整图片尺寸：
<el-image
    :style="{
        width: windowWidth < 768 ? '60px' : '80px',
        height: windowWidth < 768 ? '60px' : '80px'
    }"
>
7.:preview-teleported="true"
这个属性通常用于控制模态框的挂载位置：

​作用​：

控制模态框是否渲染到 <body>元素下（而不是当前组件内部）

确保模态框在 DOM 层级中位于顶层，避免被父元素的样式影响

​使用场景​：

当需要确保模态框不被父元素的 overflow: hidden或 z-index限制时

在复杂布局中保证模态框显示在最上层

8.hide-on-click-modal
这个属性控制点击模态框背景时的行为：

​作用​：

当设置为 true时，点击模态框的背景遮罩层会关闭模态框

当设置为 false时，点击背景不会关闭模态框

​使用场景​：

对于重要操作（如确认删除），通常设置为 false防止误触关闭

对于普通信息展示，可以设置为 true方便用户关闭
```

4.多图支持：

```
多图支持​：

如果一行有多张图片，可以这样显示：
<template #default="scope">
  <div class="image-container">
    <el-image
        v-for="(url, index) in scope.row.imageUrls"
        :key="index"
        :src="url"
        :preview-src-list="scope.row.imageUrls"
        style="width: 60px; height: 60px; margin-right: 5px;"
    ></el-image>
  </div>
</template>
```



## 5.表单

### 5.1映射字典

1.字典值加载：
•使用getDictItemsAPI从后端获取字典值
•字典名称AttendanceStatus对应考勤状态字典
2.下拉选择器：
•使用el-select组件替代DictLabel
•绑定v-model="queryParams.status"保持数据同步
•使用el-option遍历字典值生成选项



解决下拉选项显示问题
formData字段值类型为number
字典值类型为varchar

```
                <el-form-item label="考核季度" prop="periodQuarter">
                  <el-select
                    v-model="formData.periodQuarter"
                    placeholder="考核季度"
                    clearable
                    filterable
                  >
                    <el-option
                      v-for="item in periodQuarterOptions"
                      :key="Number(item.value)"
                      :label="item.label"
                      :value="Number(item.value)"
                    />
                  </el-select>
                </el-form-item>
```

### 5.2映射选项

               <el-form-item label="会员卡号" prop="memberId">
                  <el-select
                    v-model="formData.memberId"
                    placeholder="请选择会员卡号"
                    clearable
                    filterable
                  >
                    <el-option
                      v-for="item in aioveuMemberOption"
                      :key="item .memberId"
                      :label="item .memberNo"
                      :value="item .memberId"
                    />
                  </el-select>
                </el-form-item>

### 5.3可见但不可编辑状态

```
将会员等级ID字段设置为可见但不可编辑状态，使用禁用状态（disabled）比隐藏字段更透明
<el-form-item label="会员等级ID" prop="id">
  <!-- 使用 disabled 属性使输入框不可编辑 -->
  <el-input
    v-model="formData.id"
    placeholder="会员等级ID"
    disabled
  />
</el-form-item>
```

### 5.4使用只读输入框

```
<el-form-item label="会员等级ID" prop="id">
  <!-- 使用只读输入框 -->
  <el-input
    v-model="formData.id"
    placeholder="会员等级ID"
    readonly
  />
</el-form-item>
```

### 5.5添加图标提示

```
<el-form-item label="会员等级ID" prop="id">
  <el-input
    v-model="formData.id"
    placeholder="会员等级ID"
    disabled
  >
    <template #prefix>
      <el-icon><lock /></el-icon>
    </template>
  </el-input>
</el-form-item>

//----------------------------------------------------------------
                <el-form-item label="会员卡号" prop="memberId">
                  <el-select
                    v-model="formData.memberId"
                    placeholder="请选择会员卡号"
                    clearable
                    filterable
                    disabled
                  >
                    <template #prefix>
                      <el-icon><lock /></el-icon>
                    </template>
                    <el-option
                      v-for="item in aioveuMemberOption"
                      :key="item .memberId"
                      :label="item .memberNo"
                      :value="item .memberId"
                    />
                  </el-select>
                </el-form-item>
```

设计考虑
用户体验：
使用禁用状态（disabled）比隐藏字段更透明
添加锁图标直观表示字段不可编辑
浅灰色背景提示用户这是只读内容

安全性：

主键值仍然包含在表单数据中
后端需要验证用户是否有权修改该ID对应的记录
防止用户尝试修改主键值

表单验证：

即使字段不可编辑，仍然可以参与表单验证
确保提交时包含必要的主键信息
这种设计既保持了表单的完整性，又清晰地展示了哪些字段是只读的，同时确保后端能够正确识别要修改的记录。

### 5.6弹窗设计

```
 <!-- 充值操作特有字段 -->
 <template v-if="dialog.type === 'recharge'">
  </template>
  
 <!-- 新增/编辑操作字段 -->
  <template v-else>
  </template>
//-----------------------------------------------------------------------------  
  <!-- 编辑特有字段 -->
 <template v-if="dialog.type === 'edit'">
                 <el-form-item label="会员卡号" prop="memberId">
                  <el-select
                    v-model="formData.memberId"
                    placeholder="请选择会员卡号"
                    clearable
                    filterable
                    disabled
                  >
                    <template #prefix>
                      <el-icon><lock /></el-icon>
                    </template>
                    <el-option
                      v-for="item in aioveuMemberOption"
                      :key="item .memberId"
                      :label="item .memberNo"
                      :value="item .memberId"
                    />
                  </el-select>
                </el-form-item>
  </template>
  
  <!-- 新增操作字段 --> 
  <template v-else>
                    <el-form-item label="会员卡号" prop="memberId">
                  <el-select
                    v-model="formData.memberId"
                    placeholder="请选择会员卡号"
                    clearable
                    filterable
                  >
                    <el-option
                      v-for="item in aioveuMemberOption"
                      :key="item .memberId"
                      :label="item .memberNo"
                      :value="item .memberId"
                    />
                  </el-select>
                </el-form-item>
    
  </template>
```

### 5.7输入框name

```
                <el-form-item label="员工" prop="employeeName">
                      <el-input
                          v-model="formData.employeeName"
                          placeholder="员工"
                      />
                </el-form-item>
```

### 5.8输入框textarea

```
type="textarea"

                <el-form-item label="权益描述" prop="benefits">
                      <el-input
                          v-model="formData.benefits"
                          placeholder="权益描述"
                          type="textarea"
                      />
                </el-form-item>
```

